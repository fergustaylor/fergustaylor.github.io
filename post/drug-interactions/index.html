<!DOCTYPE HTML>

<!-- 
Strata by HTML5 UP
html5up.net | @n33co
Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Drug Interactions &middot; Fergus Taylor</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="author" content="Fergus Taylor">
		<meta name="description" content="Project Data analysis">
		<meta http-equiv="content-language" content="en-uk" />

		
		<meta name="og:site_name" content="Fergus Taylor">
		<meta name="og:title" content="Drug Interactions">
		<meta name="og:url" content="https://fergustaylor.github.io/post/drug-interactions/">
		
		<meta name="og:image" content="https://fergustaylor.github.io/images/avatar.jpg">
		
		

		<meta name="generator" content="Hugo 0.29" />

		<!--[if lte IE 8]><script src='https://fergustaylor.github.io/js/ie/html5shiv.js'></script><![endif]-->
		<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="https://fergustaylor.github.io/css/main.css" />
		<!--[if lte IE 8]><link rel="stylesheet" href="https://fergustaylor.github.io//css/ie8.css"><![endif]-->

		
		
	</head>

	<body id="top">
		<!-- Header -->
<header id="header">
	
	<a href="https://fergustaylor.github.io/" class="image avatar"><img src="https://fergustaylor.github.io/images/avatar.jpg" alt="" /></a>
	
	
		<h1><strong>I&rsquo;m Fergus Taylor</strong>, a Glasgow Uni Med Student. <br> I use this site to display project data analysis<br> as I learn to use <a href="//twitter.com/hashtag/Rstats?src=hash">#Rstats</a>.</h1>
	

	
		<nav id="sidebar">
			<ul>
			
				<li><a href="https://fergustaylor.github.io/">Home</a></li>
			
				<li><a href="https://fergustaylor.github.io/post">Archive</a></li>
			
			</ul>
		</nav>
	
</header>


		<!-- Main -->
		<div id="main">
			
	<span>
		<h1>Drug Interactions</h1>

		<i class="fa fa-calendar"></i>&nbsp;&nbsp;
<time datetime="2017-10-09 00:00:00 &#43;0000 UTC">Monday, October 9, 2017</time>&nbsp;&nbsp;




    
    
        <i class="fa fa-folder"></i>&nbsp;&nbsp;
        
        <a class="article-category-link" href="https://fergustaylor.github.io/categories/bnf">BNF</a>
        
        
    



   
   


	</span>

	<p>
	    <p>I was thinking about drug interactions the other day; as I listened to a conversation between 2 doctors on the relevant, and/or dangerous interactions that could have occured in a patient with multiple comorbidities. And I realised then, how few of these interactions I’d learnt by-heart yet then. Rather, if I’d wanted to check, I would have looked the patient’s drugs up in the BNF individually. I thought then that I should try to plot them, in the spirit of trying to understand them all, (which I’ll likely never do as new, obscure drugs come out, or as drug interactions are discovered over time).</p>
<p>As such - I’ve been trying to learn 2 new skills - webscraping to collect the data (in this first post), and the use of <a href="https://d3js.org">D3</a> to present it. Which is one of the larger current standards for web graphics, including many notable newspapers.</p>
<p>Luckily all the drug interactions are listed <a href="https://bnf.nice.org.uk/interaction/">online</a> through the BNF, so I can import and update all this information easily. There are much better ways to do this, however as a novice I noticed that each drug interaction page follows the same format wherein the phrase “View all interactions for [drug]” appears underneath each interactant. As such, I can search for each instance of the phrase, and take the drug names from each example.</p>
<p>For example - Abacavir</p>
<p><img src="blogimages/abacavir.png" alt="" style="width:100%;height:auto;"></p>
<pre class="r"><code>library(rvest)
library(magrittr)
library(stringr)
library(tidyverse)

examplehtml &lt;- &quot;https://bnf.nice.org.uk/interaction/abacavir-2.html&quot;

example_string &lt;- str_c(&quot;#&quot;, examplehtml) %&gt;%
  str_replace(&quot;https://bnf.nice.org.uk/interaction/&quot;, replacement= &quot;&quot;) %&gt;%
  str_replace(&quot;.html&quot;, replacement= &quot;&quot;)

example_string2 &lt;- examplehtml %&gt;%
  str_replace(&quot;https://bnf.nice.org.uk/interaction/&quot;, replacement= &quot;&quot;) %&gt;%
  str_replace(&quot;.html&quot;, replacement= &quot;&quot;) %&gt;%
  str_replace(&quot;-2&quot;, replacement= &quot;&quot;) %&gt;%
  str_replace_all(&quot;-&quot;, replacement= &quot; &quot;) %&gt;%
  str_to_title()

list_example &lt;- read_html(examplehtml) %&gt;%
  html_nodes(example_string) %&gt;%
  html_text() %&gt;%
  strsplit(split = &quot;\n&quot;) %&gt;%
  unlist() %&gt;%
  str_trim(side = &quot;both&quot;) %&gt;%
  str_subset(&quot;View all interactions&quot;) %&gt;%
  str_replace_all(pattern = &quot;View all interactions for &quot;, replacement = &quot;&quot;)

dataframe_example &lt;- data.frame(drug=example_string2, interacts_with=list_example, row.names=NULL)</code></pre>
<p>This gives me a table of the example abacavir, an antiviral.</p>
<pre><code>##       drug interacts_with
## 1 Abacavir   Fosphenytoin
## 2 Abacavir      Methadone
## 3 Abacavir       Orlistat
## 4 Abacavir  Phenobarbital
## 5 Abacavir      Phenytoin
## 6 Abacavir      Primidone
## 7 Abacavir      Ribavirin
## 8 Abacavir     Rifampicin
## 9 Abacavir     Tipranavir</code></pre>
<p>So if I make it into a function.</p>
<pre class="r"><code>interactionstable &lt;- function(url){

example_string &lt;- str_c(&quot;#&quot;, url) %&gt;%
  str_replace(&quot;https://bnf.nice.org.uk/interaction/&quot;, replacement= &quot;&quot;) %&gt;%
  str_replace(&quot;.html&quot;, replacement= &quot;&quot;)

example_string2 &lt;- url %&gt;%
  str_replace(&quot;https://bnf.nice.org.uk/interaction/&quot;, replacement= &quot;&quot;) %&gt;%
  str_replace(&quot;.html&quot;, replacement= &quot;&quot;) %&gt;%
  str_replace(&quot;-2&quot;, replacement= &quot;&quot;) %&gt;%
  str_replace(&quot;-&quot;, replacement= &quot; &quot;) %&gt;%
  str_to_title()

list_example &lt;- read_html(url) %&gt;%
  html_nodes(example_string) %&gt;%
  html_text() %&gt;%
  strsplit(split = &quot;\n&quot;) %&gt;%
  unlist() %&gt;%
  str_trim(side = &quot;both&quot;) %&gt;%
  str_subset(&quot;View all interactions&quot;) %&gt;%
  str_replace_all(pattern = &quot;View all interactions for &quot;, replacement = &quot;&quot;)

class_example &lt;- read_html(url) %&gt;%
  html_nodes(&quot;h3&quot;) %&gt;%
  html_text() %&gt;%
  strsplit(split = &quot;\n&quot;) %&gt;%
  unlist() %&gt;%
  str_trim(side = &quot;both&quot;) %&gt;%
  str_subset(&quot;belongs to&quot;) %&gt;%
  str_replace_all(pattern = &quot; and has the following interaction information&quot;, replacement = &quot;&quot;) %&gt;%
  strsplit(&quot;.* belongs to &quot;) %&gt;%
  unlist()

if (identical(list_example, character(0))==FALSE){
  dataframe_example &lt;- data.frame(drug=example_string2, interacts_with=list_example, class=class_example[2], row.names=NULL)
}
else {dataframe_example &lt;- data.frame(drug=example_string2, interacts_with=NA, class=class_example[2], row.names=NULL)
}

as.character(dataframe_example$drug)
as.character(dataframe_example$interacts_with)

return(dataframe_example)
}</code></pre>
<p>Then I create a list of each URL, (i.e each drug/general class listed in the index).</p>
<pre class="r"><code>drugs_list &lt;- paste(readLines(&quot;https://bnf.nice.org.uk/interaction/&quot;), collapse=&quot;\n&quot;) %&gt;%
  str_match_all(&quot;&lt;a href=\&quot;(.*?)\&quot;&quot;) %&gt;%
  unlist() %&gt;%
  str_replace_all(pattern = &quot;&lt;a href=\&quot;&quot;, replacement=&quot;&quot;) %&gt;%
  str_replace_all(pattern = &quot;\&quot;&quot;, replacement=&quot;&quot;) %&gt;%
  unique()
drugs_list &lt;- drugs_list[34:1206]
drugs_list &lt;- str_c(&quot;https://bnf.nice.org.uk/interaction/&quot;, drugs_list)</code></pre>
<p>I can apply my function to everything, and create a dataset. I’ve done this in thirds due to the size of data involved; any larger any it timed-out partway through.</p>
<pre class="r"><code>first &lt;- bind_rows(lapply(drugs_list[1:300], interactionstable))
second &lt;- bind_rows(lapply(drugs_list[301:600], interactionstable))
third &lt;- bind_rows(lapply(drugs_list[601:1173], interactionstable))

dataset &lt;- bind_rows(first, second, third)</code></pre>
<p>I’ll add classes next and try to apply this data to a D3 model, such as a Sankey diagram.</p>

	</p>
  
  <br>
  
  <a href="https://fergustaylor.github.io/post/post10/">Prev: 'openprescribingR Plots3'</a>

	

		</div>

		<!-- Footer -->
<footer id="footer">
	<ul class="icons">
		
		
		
		<li><a href="//twitter.com/ferguswtaylor" target="_blank" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
		
		
		<li><a href="//github.com/fergustaylor" target="_blank" class="icon fa-github"><span class="label">GitHub</span></a></li>
		
		
		
		
		
		
		
		<li><a href="https://fergustaylor.github.io/index.xml" class="icon fa-rss" type="application/rss+xml"><span class="label">RSS</span></a></li>
		
	</ul>

	<ul class="copyright">
		
		<li>&copy; Fergus Taylor</li>
		
		<li>Images my own.</li>
		
		<li>Design: <a href="//html5up.net">HTML5 UP</a></li>
		
	</ul>
</footer>

<!-- Scripts -->
<script src="https://fergustaylor.github.io/js/jquery.min.js"></script>
<script src="https://fergustaylor.github.io/js/jquery.poptrox.min.js"></script>
<script src="https://fergustaylor.github.io/js/skel.min.js"></script>
<script src="https://fergustaylor.github.io/js/util.js"></script>

<script src="https://fergustaylor.github.io/js/main.js"></script>


<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-107299466-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>




	</body>
</html>
