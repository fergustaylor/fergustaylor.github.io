---
title: "R Notebook"
output: html_notebook
---

__More examples for openprescribingR__

#Notes
This package works by interacting with the openprescribing.net api.
openprescribing.net continues to collate monthly data from NHS digital, which means that you can search the entire dataset without downloading each monthly file.
It uses limited search arguments to return data. (This will be updated as the api changes). As such it's not possible to return a desired dataset in some cases by using one function in this package.
However, it is possible to cross-reference functions in order to return the dataset you'd like.
(And I may create new functions to do this automatically in new updates)

Each function is based on the set-up of the api.

For example, CCG_boundaries_or_location can return the location of a practice in a CCG.

https://openprescribing.net/api/1.0/org_location/?q=99H,P87003

which becomes 

CCG_boundaries_or_location(CCG_code = "99H", practice_code = "P87003")

However, it won't return all the practice locations in the ccg by inputting the ccg alone.
But by cross-referencing 

```{r, echo=FALSE}
library(openprescribingR)
library(tidyverse)
```

##CCG_boundaries_or_location
All organisations matching a code or name
```{r}
organisation_codes(organisation_code_or_name= "wish") %>%
  head(3)
```
```{r}
organisation_codes(organisation_code_or_name= "G81083") %>%
  head(3)
```

Boundaries of all CCGs 
```{r, eval=FALSE}
CCG_boundaries_or_location()
```

Boundaries of an individual CCG
```{r, eval=FALSE}
CCG_boundaries_or_location(CCG_code = "99H")
```

Location (approximate) of a practice, or practices in a CCG, by code
```{r, eval=FALSE}
CCG_boundaries_or_location(CCG_code = "99H", practice_code = "P87003")
```

##drug_details
All BNF sections, chemicals and presentations matching a name (case-insensitive) 
```{r}
drug_details(name= "lipid") %>%
  head(3)
```

All chemicals and presentations matching a code =
```{r}
drug_details(chemical_section_or_presentation_code= "0212000AA") %>%
  head(3)
```

All BNF sections matching a code
```{r}
drug_details(BNF_section= "2.4") %>%
  head(3)
```

All BNF sections, chemicals and presentations exactly matching a name or code = 
```{r}
drug_details(exact_name_or_code= "212000AA") %>%
  head(3)
```

```{r}
drug_details(name="lipid&q=drug") %>%
  head(3)
```

##list_size
Total list size for all CCGs
```{r}
list_size() %>%
  head(3)
```

Total list size by practice code, or CCG code
```{r}
list_size(list_size_by_code= "P87003") %>%
  head(3)
```

Total list size by practice code, or CCG code
```{r}
list_size(list_size_by_code= "99H") %>%
  head(3)
```

ASTRO-PU cost and items for practices by practice code, or CCG code
```{r}
list_size(ASTRO_PU_by_code= "P87003") %>%
  head(3)
```

ASTRO-PU cost and items for practices by practice code, or CCG code
```{r}
list_size(ASTRO_PU_by_code= "99H") %>%
  head(3)
```

##organisation_codes
All organisations matching a code or name 
```{r}
organisation_codes(organisation_code_or_name= "Beaumont") %>%
  head(3)
```

All CCGs matching a code or name 
```{r}
organisation_codes(CCG_code_or_name= "Gloucester") %>%
  head(3)
```

All practices matching a code or name 
```{r}
organisation_codes(practice_code_or_name= "Gloucester") %>%
  head(3)
```

All organisations exactly matching a code or name 
```{r}
organisation_codes(exact_name_or_code= "99H") %>%
  head(3)
```

Or a variation of the above (with at least 1 organisation_code_or_name, CCG_code_or_name, practice_code_or_name, or exact_name_or_code).
N.B For now the use of multiple terms in one category requires "&q="
```{r}
organisation_codes(organisation_code_or_name= "Beaumont&q=Gloucester") %>%
  head(3)
```

##spending_by_CCG
```{r}
spending_by_CCG(chemical_section_or_presentation_code = "0212000AA") %>%
  head(3) 
```

```{r}
spending_by_CCG(CCG_code = "03V") %>%
  head(3)
```

```{r}
spending_by_CCG(chemical_section_or_presentation_code = "0212000AA", CCG_code = "03V") %>%
  head(3)
```

##spending_by_code
```{r}
spending_by_code() %>%
  head(3)
```

```{r}
spending_by_code(BNF_code = "0212") %>%
  head(3)
```

```{r}
spending_by_code(BNF_code = "0212000AA") %>%
  head(3)
```

```{r}
spending_by_code(BNF_code = "0212000AABB") %>%
  head(3)
```

```{r}
spending_by_code(BNF_code = "2.4") %>%
  head(3)
```

```{r}
spending_by_code(BNF_code = drug_details(BNF_section = "2.4")$id[1]) %>%
  head(3)
```

```{r}
id <- drug_details(BNF_section = "2.4") %>%
  dplyr::filter(name=="Beta-Adrenoceptor Blocking Drugs") %>%
  dplyr::select(id)

spending_by_code(BNF_code = id) %>%
  head(3)
```

##spending_by_practice
```{r}
spending_by_practice(BNF_section_code = "0212", date_code = "2015-04-01") %>%
  head(3)
```

```{r}
spending_by_practice(chemical_code = "0212000AA", date_code = "2015-04-01") %>%
  head(3)
```

```{r}
spending_by_practice(practice_code = "H81068") %>%
  head(3)
```

```{r}
spending_by_practice(CCG_code = "03V") %>%
  head(3)
```

Or a variation of the above (with at least 1 practice_code, date_code, or CCG_code).
N.B A BNF section gives a prefix to the chemical, which gives a prefix to the presentation/product format.
 e.g. "0212" are lipid-regulating drugs, "0212000AA" is Rosuvastatin Calcium, "0212000AAAAAAAA" is Rosuvastatin Calc_Tab 10mg. 
