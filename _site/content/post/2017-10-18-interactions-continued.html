---
title: Interactions Continued
author: Fergus Taylor
date: '2017-10-18'
slug: interactions-continued
categories:
  - BNF
tags: []
header_image: "/blogimages/sankeyexample.png"
draft: false
output:
  blogdown::html_page
---



<p>I made a few additions to my previous <a href="https://fergustaylor.github.io/post/drug-interactions/">post</a>, after realising I could use the <a href="https://cran.r-project.org/web/packages/rvest/vignettes/selectorgadget.html">CSS selector</a> to list the interaction information. (I.e if you combine drugs, will it increase the blood concentration of the other? Or reduce it? Or risk a given side-effect, etc..)</p>
<p>I built this into the previous code. <a href="https://github.com/fergustaylor/d3">(See the full code)</a>.</p>
<pre class="r"><code>#Interactions
interactions &lt;- mapply(url = data, css = drugs_list$css_string, 
                       function(url, css){
                          url %&gt;%
                          html_nodes(css) %&gt;%
                          html_text()
                        })
example_dataframe &lt;- cbind(example_dataframe, data_frame(interactions))

#Rename columns
example_dataframe &lt;-  example_dataframe %&gt;%
  rename(Class = &#39;class&#39;,
         &#39;Dangerous Interactions&#39; = &#39;dangerousi&#39;,
         Interactions = &#39;interactions&#39;)</code></pre>
<p><img src="/blogimages/interactionsinfo.png" alt="" style="width:100%;height:auto;"></p>
<p>Afterwards I then looked up <a href="https://openprescribing.net/">openprescribing.net</a>, which I’ve used <a href="https://fergustaylor.github.io/categories/openprescribing/">in previous posts.</a>. This turned out to be the easiest way to find an index of BNF chapters online which I scraped to create an index table.</p>
<pre class="r"><code>BNFchapters &lt;- readLines(&quot;https://openprescribing.net/bnf/&quot;) %&gt;%
  str_match_all(&quot;&lt;a href=\&quot;/bnf/(.*?)\&quot;&gt;(.*?)&lt;/a&gt;&quot;) %&gt;%
  unlist() %&gt;%
  data.frame() 

BNFchapters &lt;- BNFchapters %&gt;%
  data.frame(cbind(observation = rep(1:(nrow(BNFchapters)/3), each=3))) %&gt;%
  data.frame(cbind(class = c(&quot;String&quot;, &quot;Link&quot;, &quot;Title&quot;))) %&gt;%
  rename(value = &#39;.&#39;) %&gt;%
  spread(key=class, value=value)

BNFchapters &lt;- BNFchapters %&gt;%
  dplyr::select(-observation, -String)

BNFchapters &lt;- BNFchapters[2:518,]</code></pre>
<pre><code>##      Link                                               Title
## 2     01/                         1: Gastro-Intestinal System
## 3   0101/   1.1: Dyspep&amp;amp;Gastro-Oesophageal Reflux Disease
## 4 010101/                      1.1.1: Antacids and Simeticone
## 5 010102/ 1.1.2: Compound Alginates&amp;amp;Prop Indigestion Prep
## 6   0102/   1.2: Antispasmod.&amp;amp;Other Drgs Alt.Gut Motility</code></pre>
<p>I’ll continue this work using a chemical look-up file from data.gov to add specific BNF codes to each drug listed here, so I can group them by sections.</p>
